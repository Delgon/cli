<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://ibm-mas.github.io/cli/commands/mirror-images/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>mirror-images - MAS CLI</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "mirror-images";
        var mkdocs_page_input_path = "commands/mirror-images.md";
        var mkdocs_page_url = "/cli/commands/mirror-images/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> MAS CLI
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../changes/">Changes</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../guides/choosing-the-right-catalog/">Choosing the Right Catalog</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guides/install/">Install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guides/update/">Update</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guides/upgrade/">Upgrade</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Commands</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../provision-fyre/">provision-fyre</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../provision-roks/">provision-roks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../provision-rosa/">provision-rosa</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../setup-registry/">setup-registry</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">mirror-images</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#mirror-mode">Mirror Mode</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#registry-details">Registry Details</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#registry-authentication">Registry Authentication</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#source-registry-entitlements">Source Registry Entitlements</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#maximo-operator-catalog-selection">Maximo Operator Catalog Selection</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#maximo-core-image-mirroring-configuration">Maximo Core Image Mirroring Configuration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#maximo-iot-image-mirroring-configuration">Maximo IoT Image Mirroring Configuration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#maximo-manage-image-mirroring-configuration">Maximo Manage Image Mirroring Configuration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#other-options">Other Options</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#interactive-image-mirroring">Interactive Image Mirroring</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#two-phase-image-mirroring">Two-Phase Image Mirroring</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#phase-1-mirror-to-filesystem">Phase 1: Mirror to Filesystem</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#phase-2-mirror-from-filesystem">Phase 2: Mirror from Filesystem</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#direct-image-mirroring">Direct Image Mirroring</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configure-airgap/">configure-airgap</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../install/">install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../must-gather/">must-gather</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configtool-oidc/">configtool-oidc</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Catalogs</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../catalogs/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../catalogs/v8-230414-amd64/">Apr 14 2023</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../catalogs/v8-230314-amd64/">Mar 14 2023</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../catalogs/v8-230217-amd64/">Feb 17 2023</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../catalogs/v8-230111-amd64/">Jan 11 2023</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">MAS CLI</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Commands &raquo;</li>
      <li>mirror-images</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/ibm-mas/cli/blob/master/docs/commands/mirror-images.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="mirror-images">Mirror Images<a class="headerlink" href="#mirror-images" title="Permanent link"></a></h1>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link"></a></h2>
<p><code>mas mirror-images [options]</code></p>
<h3 id="mirror-mode">Mirror Mode<a class="headerlink" href="#mirror-mode" title="Permanent link"></a></h3>
<ul>
<li><code>-m|--mode MIRROR_MODE</code> Operation mode (direct, to-filesystem, from-filesystem)</li>
<li><code>-d|--dir MIRROR_WORKING_DIR</code> Working directory for the mirror process</li>
</ul>
<h3 id="registry-details">Registry Details<a class="headerlink" href="#registry-details" title="Permanent link"></a></h3>
<ul>
<li><code>-H|--host REGISTRY_PUBLIC_HOST</code> Hostname of the target registry</li>
<li><code>-P|--port REGISTRY_PUBLIC_PORT</code> Port number for the target registry</li>
</ul>
<h3 id="registry-authentication">Registry Authentication<a class="headerlink" href="#registry-authentication" title="Permanent link"></a></h3>
<ul>
<li><code>-u|--username REGISTRY_USERNAME</code> Username to authenticate to the target registry</li>
<li><code>-p|--password REGISTRY_PASSWORD</code> Password to authenticate to the target registry</li>
</ul>
<h3 id="source-registry-entitlements">Source Registry Entitlements<a class="headerlink" href="#source-registry-entitlements" title="Permanent link"></a></h3>
<ul>
<li><code>--ibm-entitlement IBM_ENTITLEMENT_KEY</code> IBM Entitlement Key</li>
<li><code>--redhat-username REDHAT_CONNECT_USERNAME</code> Red Hat Connect Username</li>
<li><code>--redhat-password REDHAT_CONNECT_PASSWORD</code> Red Hat Connect Password</li>
</ul>
<h3 id="maximo-operator-catalog-selection">Maximo Operator Catalog Selection<a class="headerlink" href="#maximo-operator-catalog-selection" title="Permanent link"></a></h3>
<ul>
<li><code>-c|--catalog MAS_CATALOG_VERSION</code> Maximo Operator Catalog Version to mirror (e.g. v8-221129)</li>
<li><code>-C|--channel MAS_CHANNEL</code> Maximo Application Suite Channel to mirror (e.g. 8.9.x)</li>
<li><code>--mirror-core</code> Mirror images for IBM Maximo Application Suite Core &amp; dependencies</li>
<li><code>--mirror-assist</code>  Mirror images for IBM Maximo Assist</li>
<li><code>--mirror-iot</code> Mirror images for IBM Maximo IoT &amp; dependencies</li>
<li><code>--mirror-manage</code> Mirror images for IBM Maximo Manage &amp; dependencies</li>
<li><code>--mirror-monitor</code> Mirror images for IBM Maximo Monitor</li>
<li><code>--mirror-predict</code> Mirror images for IBM Maximo Predict</li>
<li><code>--mirror-optimizer</code> Mirror images for IBM Maximo Optimizer</li>
<li><code>--mirror-visualinspection</code> Mirror images for IBM Maximo Visual Inspection</li>
</ul>
<h3 id="maximo-core-image-mirroring-configuration">Maximo Core Image Mirroring Configuration<a class="headerlink" href="#maximo-core-image-mirroring-configuration" title="Permanent link"></a></h3>
<ul>
<li><code>--skip-cfs</code> Skip mirroring images for IBM Cloud Pak Foundation Services</li>
<li><code>--skip-uds</code> Skip mirroring images for IBM User Data Services</li>
<li><code>--skip-sls</code> Skip mirroring images for IBM Suite License Service</li>
<li><code>--skip-tsm</code> Skip mirroring images for IBM Truststore Manager</li>
<li><code>--skip-mongo</code> Skip mirroring images for MongoDb Community Edition</li>
</ul>
<h3 id="maximo-iot-image-mirroring-configuration">Maximo IoT Image Mirroring Configuration<a class="headerlink" href="#maximo-iot-image-mirroring-configuration" title="Permanent link"></a></h3>
<ul>
<li><code>--skip-db2</code> Skip mirroring images for IBM Db2 dependency</li>
</ul>
<h3 id="maximo-manage-image-mirroring-configuration">Maximo Manage Image Mirroring Configuration<a class="headerlink" href="#maximo-manage-image-mirroring-configuration" title="Permanent link"></a></h3>
<ul>
<li><code>--skip-db2</code> Skip mirroring images for IBM Db2 dependency</li>
</ul>
<h3 id="other-options">Other Options<a class="headerlink" href="#other-options" title="Permanent link"></a></h3>
<ul>
<li><code>--no-confirm</code> Mirror images without prompting for confirmation</li>
<li><code>-h|--help</code> Show help message</li>
</ul>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link"></a></h2>
<h3 id="interactive-image-mirroring">Interactive Image Mirroring<a class="headerlink" href="#interactive-image-mirroring" title="Permanent link"></a></h3>
<pre><code class="language-bash">docker run -ti --rm -v /mnt/registry:/mnt/registry --pull always quay.io/ibmmas/cli mas mirror-images
</code></pre>
<h3 id="two-phase-image-mirroring">Two-Phase Image Mirroring<a class="headerlink" href="#two-phase-image-mirroring" title="Permanent link"></a></h3>
<p>Two-Phase image mirroring is required when you do not have a single system with both access to the public registries containing the source container images <strong>and</strong> your internal private registry.  In this case you will require a system with internet connectivity and another with access to your private network, along with a means to transfer data from one to the other (for example, a portable drive).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The examples here use a specific version of the container image (3.3.0).  You should always use the latest available container image, but because we are working in a disconnected environment we need to be specific about the version we are using.  Replace <code>3.3.0</code> with the appropriate version.</p>
</div>
<h4 id="phase-1-mirror-to-filesystem">Phase 1: Mirror to Filesystem<a class="headerlink" href="#phase-1-mirror-to-filesystem" title="Permanent link"></a></h4>
<p>First, download the latest version of the container image and start up a terminal session inside the container image, we are going to mount a local directory into the running container to persist the mirror filesystem.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Mirroring images for Core, Manage and all dependencies will require approximately 62Gb available capacity.</p>
</div>
<pre><code class="language-bash">docker pull quay.io/ibmmas/cli:3.3.0
docker run -ti --rm -v /mnt/registry:/mnt/registry quay.io/ibmmas/cli:3.3.0 mas mirror-images \
  --mode to-filesystem \
  --dir /mnt/registry \
  --ibm-entitlement $IBM_ENTITLEMENT_KEY \
  --redhat-username $REDHAT_CONNECT_USERNAME \
  --redhat-password $REDHAT_CONNECT_PASSWORD \
  -H mirror.mydomain.com -P 32500 \
  -u $MIRROR_USERNAME -p $MIRROR_PASSWORD \
  -c v8-220927-amd64 -C 8.9.x \
  --mirror-core --mirror-iot --mirror-manage --mirror-optimizer \
  --no-confirm
</code></pre>
<p>Once this process completes you will find the mirrored images in <code>/mnt/registry</code> ready to transfer to the system inside your disconnected network on which we will perform phase 2 of this operator.  However, before we can do that we also need to mirror the CLI image to your mirror registry so that it's available on the disconnected host system.</p>
<pre><code class="language-bash">oc image mirror --dir /mnt/registry quay.io/ibmmas/cli:3.3.0 file://ibmmas/cli:3.3.0
</code></pre>
<h4 id="phase-2-mirror-from-filesystem">Phase 2: Mirror from Filesystem<a class="headerlink" href="#phase-2-mirror-from-filesystem" title="Permanent link"></a></h4>
<p>Transfer the content of <code>/mnt/registry</code> to your system in the disconnected network.  Now we are going to put the CLI image in your registry:</p>
<pre><code class="language-bash">docker login &lt;YOURPRIVATEREGISTRY&gt; -u MIRROR_USERNAME -p MIRROR_PASSWORD
oc image mirror --dir /mnt/myportabledisk file://ibmmas/cli:3.3.0 mirror.mydomain.com:32500/ibmmas/cli:3.3.0
</code></pre>
<p>Now we are ready to mirror the images to your registry using the CLI image in the same way we mirrored the images to the local disk in the first place:</p>
<pre><code class="language-bash">docker pull mirror.mydomain.com:32500/ibmmas/cli:3.3.0
docker run -ti --rm -v /mnt/mirrorregistry:/mnt/mirrorregistry mirror.mydomain.com:32500/ibmmas/cli:3.3.0 mas mirror-images \
  --mode from-filesystem \
  --dir /mnt/registry \
  --ibm-entitlement $IBM_ENTITLEMENT_KEY \
  --redhat-username $REDHAT_CONNECT_USERNAME \
  --redhat-password $REDHAT_CONNECT_PASSWORD \
  -H mirror.mydomain.com -P 32500 \
  -u $MIRROR_USERNAME -p $MIRROR_PASSWORD \
  -c v8-220927-amd64 -C 8.9.x \
  --mirror-core --mirror-iot --mirror-manage --mirror-optimizer \
  --no-confirm
</code></pre>
<h3 id="direct-image-mirroring">Direct Image Mirroring<a class="headerlink" href="#direct-image-mirroring" title="Permanent link"></a></h3>
<p>The following example will mirror all images required for Maximo Application Suite Core and the Maximo Manage and IoT applications directly to your target registry, without prompting for confirmation.</p>
<pre><code class="language-bash">docker run -ti --rm --pull always quay.io/ibmmas/cli mas mirror-images \
  --mode direct \
  --dir /mnt/registry \
  --ibm-entitlement $IBM_ENTITLEMENT_KEY \
  --redhat-username $REDHAT_CONNECT_USERNAME \
  --redhat-password $REDHAT_CONNECT_PASSWORD \
  -H mirror.mydomain.com -P 32500 \
  -u $MIRROR_USERNAME -p $MIRROR_PASSWORD \
  -c v8-220927-amd64 -C 8.9.x \
  --mirror-core --mirror-iot --mirror-manage --mirror-optimizer \
  --no-confirm
</code></pre>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ibm-mas/cli" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../setup-registry/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../configure-airgap/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
